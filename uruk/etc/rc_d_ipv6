# this file maintained using arch at http://arch.gna.org/uruk/

# Copyright (C) 2005 Joost van Baal
#
# This file is part of Uruk.  Uruk is free software; you can redistribute
# it and/or modify it under the terms of the GNU GPL, see the file named
# COPYING.

# rc_d_ipv6 - have your rc_d source this file if you'd like to play with
#               IPv6 support in uruk
#
# New variables used: ip6_<...>, sources6_<...>, ip6tables.
# Be sure you've set "enable_ipv6=true" in /etc/default/uruk.

for iface in $interfaces
do
    eval is="\"\$ips_${iface}\""
    if test -n "$is"
    then
        interfaces_x=
        for i in $is
        do
            interfaces_x="$interfaces_x ${iface}_$i"
        done
    else
        interfaces_x=$iface
    fi

    for iface_x in $interfaces_x
    do
        eval ip="\"\$ip6_${iface_x}\""

        for proto in tcp udp
        do
            eval services="\"\$services_eth0_${proto}\""
            if test -n "$services"
            then
                for service in $services
                do
                    eval sources="\"\$sources6_eth0_${proto}_${service}\""
                    eval ports="\"\$ports_eth0_${proto}_${service}\""
                    if test -n "$ports"
                    then
                        for port in $ports
                        do
                            for source in $sources
                            do
                                $ip6tables -A INPUT \
                                  -i eth0 --protocol $proto \
                                  --source "$source" --destination "$ip" \
                                  --destination-port "$port" -j ACCEPT
                            done
                        done
                    fi
                done
            fi
        done
    done
done

